# Bots EDI REST API Documentation

Complete API documentation for the Bots EDI secure REST API system.

## üîê **Authentication**

All API requests require authentication using an API key.

### **Obtaining an API Key**

API keys must be generated by an administrator through the Django admin interface or command-line tool.

```bash
# Create an API key
cd C:\Users\USER\.bots\env\default
python usersys\api_management.py create "My API Key" edi_admin
```

### **Using Your API Key**

Include your API key in the `X-API-Key` header:

```bash
curl -H "X-API-Key: YOUR_API_KEY_HERE" http://localhost:8080/api/v1/status
```

Or as a query parameter (less secure):

```bash
curl "http://localhost:8080/api/v1/status?api_key=YOUR_API_KEY_HERE"
```

---

## üìã **API Endpoints**

### **Base URL**

```
http://localhost:8080/api/
```

---

## üìÅ **File Operations**

### **1. Upload File**

Upload an EDI file for processing.

**Endpoint:** `POST /api/v1/files/upload`

**Headers:**
- `X-API-Key`: Your API key
- `Content-Type`: multipart/form-data

**Parameters:**
- `file` (required): The EDI file to upload
- `route` (optional): Route name to use for processing
- `partner` (optional): Trading partner identifier
- `messagetype` (optional): Message type identifier

**Example:**

```bash
curl -X POST \
  -H "X-API-Key: YOUR_API_KEY" \
  -F "file=@invoice.edi" \
  -F "route=invoice_route" \
  -F "partner=PARTNER001" \
  http://localhost:8080/api/v1/files/upload
```

**Response:**

```json
{
  "success": true,
  "message": "File uploaded successfully",
  "file": {
    "name": "invoice.edi",
    "size": 2048,
    "path": "C:\\Users\\USER\\.bots\\env\\default\\botssys\\infile\\invoice_route\\invoice.edi",
    "route": "invoice_route",
    "partner": "PARTNER001",
    "messagetype": ""
  }
}
```

---

### **2. Download File**

Download a processed EDI file.

**Endpoint:** `GET /api/v1/files/download/<file_id>`

**Headers:**
- `X-API-Key`: Your API key

**Example:**

```bash
curl -H "X-API-Key: YOUR_API_KEY" \
  http://localhost:8080/api/v1/files/download/output.edi \
  -o downloaded_file.edi
```

**Response:** Binary file content

---

### **3. List Files**

List available files in the system.

**Endpoint:** `GET /api/v1/files/list`

**Headers:**
- `X-API-Key`: Your API key

**Parameters:**
- `type` (optional): `infile` or `outfile` (default: `outfile`)

**Example:**

```bash
curl -H "X-API-Key: YOUR_API_KEY" \
  "http://localhost:8080/api/v1/files/list?type=outfile"
```

**Response:**

```json
{
  "success": true,
  "type": "outfile",
  "count": 5,
  "files": [
    {
      "name": "output1.edi",
      "path": "route1/output1.edi",
      "size": 1024,
      "modified": 1699564800.0
    },
    {
      "name": "output2.xml",
      "path": "route2/output2.xml",
      "size": 2048,
      "modified": 1699564900.0
    }
  ]
}
```

---

## üöÄ **Route Operations**

### **4. Execute Route**

Execute a Bots translation route.

**Endpoint:** `POST /api/v1/routes/execute`

**Headers:**
- `X-API-Key`: Your API key
- `Content-Type`: application/json

**Body:**

```json
{
  "route": "route_name"
}
```

**Example:**

```bash
curl -X POST \
  -H "X-API-Key: YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{"route":"invoice_route"}' \
  http://localhost:8080/api/v1/routes/execute
```

**Response:**

```json
{
  "success": true,
  "route": "invoice_route",
  "output": "Processing completed successfully...",
  "errors": null
}
```

---

## üìä **Reporting**

### **5. Get Reports**

Retrieve translation reports.

**Endpoint:** `GET /api/v1/reports`

**Headers:**
- `X-API-Key`: Your API key

**Parameters:**
- `limit` (optional): Number of reports to return (default: 100)
- `status` (optional): Filter by status (`success`, `error`)

**Example:**

```bash
curl -H "X-API-Key: YOUR_API_KEY" \
  "http://localhost:8080/api/v1/reports?limit=50&status=success"
```

**Response:**

```json
{
  "success": true,
  "count": 50,
  "reports": [
    {
      "id": 12345,
      "timestamp": "2025-11-05T10:30:00Z",
      "status": "success",
      "type": "INVOIC",
      "partner": "PARTNER001",
      "filename": "invoice.edi"
    }
  ]
}
```

---

## ‚ÑπÔ∏è **System Information**

### **6. API Status**

Get API key status and usage information.

**Endpoint:** `GET /api/v1/status`

**Headers:**
- `X-API-Key`: Your API key

**Example:**

```bash
curl -H "X-API-Key: YOUR_API_KEY" \
  http://localhost:8080/api/v1/status
```

**Response:**

```json
{
  "success": true,
  "api_key": {
    "name": "Production API",
    "user": "edi_admin",
    "is_active": true,
    "rate_limit": 1000,
    "current_usage": 45,
    "usage_reset_time": "2025-11-05T11:00:00Z",
    "last_used": "2025-11-05T10:45:23Z",
    "created_at": "2025-11-01T09:00:00Z",
    "permissions": ["file_upload", "file_download", "report_view"]
  }
}
```

---

## üîí **Security Features**

### **Rate Limiting**

Each API key has a rate limit (default: 1000 requests per hour). When exceeded, you'll receive:

```json
{
  "error": "Rate limit exceeded",
  "limit": 1000,
  "reset_time": "2025-11-05T11:00:00Z"
}
```

### **IP Whitelisting**

Administrators can restrict API keys to specific IP addresses for enhanced security.

### **Permission-Based Access Control**

API keys can be assigned specific permissions:

- `file_upload` - Upload EDI files
- `file_download` - Download processed files
- `file_list` - List available files
- `file_delete` - Delete files
- `route_execute` - Execute translation routes
- `route_list` - List available routes
- `report_view` - View translation reports
- `report_download` - Download reports
- `partner_view` - View trading partners
- `partner_manage` - Manage trading partners
- `translate_view` - View translation status
- `channel_view` - View communication channels
- `admin_access` - Full administrative access

---

## üõ†Ô∏è **Error Handling**

### **Common Error Responses**

**401 Unauthorized - Missing or Invalid API Key:**

```json
{
  "error": "API key required",
  "message": "Provide API key in X-API-Key header"
}
```

**403 Forbidden - Insufficient Permissions:**

```json
{
  "error": "Insufficient permissions",
  "required": "file_upload"
}
```

**404 Not Found:**

```json
{
  "error": "File not found"
}
```

**429 Too Many Requests - Rate Limit Exceeded:**

```json
{
  "error": "Rate limit exceeded",
  "limit": 1000,
  "reset_time": "2025-11-05T11:00:00Z"
}
```

**500 Internal Server Error:**

```json
{
  "error": "Internal server error",
  "message": "Detailed error message"
}
```

---

## üìù **Code Examples**

### **Python Example**

```python
import requests

API_KEY = "your-api-key-here"
BASE_URL = "http://localhost:8080/api"

headers = {
    "X-API-Key": API_KEY
}

# Upload a file
with open("invoice.edi", "rb") as f:
    files = {"file": f}
    data = {"route": "invoice_route", "partner": "PARTNER001"}
    response = requests.post(f"{BASE_URL}/v1/files/upload", 
                            headers=headers, 
                            files=files, 
                            data=data)
    print(response.json())

# Check API status
response = requests.get(f"{BASE_URL}/v1/status", headers=headers)
print(response.json())

# Get reports
response = requests.get(f"{BASE_URL}/v1/reports?limit=10", headers=headers)
print(response.json())
```

### **JavaScript Example**

```javascript
const API_KEY = "your-api-key-here";
const BASE_URL = "http://localhost:8080/api";

// Upload a file
const uploadFile = async (file) => {
  const formData = new FormData();
  formData.append('file', file);
  formData.append('route', 'invoice_route');
  
  const response = await fetch(`${BASE_URL}/v1/files/upload`, {
    method: 'POST',
    headers: {
      'X-API-Key': API_KEY
    },
    body: formData
  });
  
  return await response.json();
};

// Get API status
const getStatus = async () => {
  const response = await fetch(`${BASE_URL}/v1/status`, {
    headers: {
      'X-API-Key': API_KEY
    }
  });
  
  return await response.json();
};
```

### **cURL Examples**

```bash
# Upload file
curl -X POST \
  -H "X-API-Key: YOUR_API_KEY" \
  -F "file=@invoice.edi" \
  -F "route=invoice_route" \
  http://localhost:8080/api/v1/files/upload

# List files
curl -H "X-API-Key: YOUR_API_KEY" \
  "http://localhost:8080/api/v1/files/list?type=outfile"

# Execute route
curl -X POST \
  -H "X-API-Key: YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{"route":"invoice_route"}' \
  http://localhost:8080/api/v1/routes/execute

# Get reports
curl -H "X-API-Key: YOUR_API_KEY" \
  "http://localhost:8080/api/v1/reports?limit=50"

# Check API status
curl -H "X-API-Key: YOUR_API_KEY" \
  http://localhost:8080/api/v1/status
```

---

## üîß **API Management**

### **Initialize Permissions**

```bash
python usersys\api_management.py init_permissions
```

### **Create API Key**

```bash
python usersys\api_management.py create "API Key Name" username
```

### **List API Keys**

```bash
python usersys\api_management.py list
```

### **Revoke API Key**

```bash
python usersys\api_management.py revoke YOUR_API_KEY
```

### **View Audit Logs**

```bash
python usersys\api_management.py audit 100
```

---

## üìû **Support**

For API support and issues:
- Check audit logs for detailed error information
- Review rate limit and permission settings
- Verify API key is active and not expired
- Ensure proper headers and request format

---

## üîÑ **Changelog**

### Version 1.0 (2025-11-05)
- Initial API release
- File upload/download operations
- Route execution
- Report retrieval
- Rate limiting
- Permission-based access control
- Audit logging
- IP whitelisting

---

**Bots EDI REST API** - Secure, scalable, and easy to integrate.
